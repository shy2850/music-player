define("reducers/playlist",["require","exports","./playlistdata","../store","wfquery"],function(e,t,a,s,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.STORE_KEY={LIST:"y_playlist",CURRENT:"y_current",PROGRESS:"y_progress",GUID:"pgv_pvid",CID:"cid",WAY:"play_way",STATUS:"play_status"};let n=localStorage.getItem(t.STORE_KEY.LIST),o=localStorage.getItem(t.STORE_KEY.CURRENT),c=localStorage.getItem(t.STORE_KEY.PROGRESS),g=localStorage.getItem(t.STORE_KEY.WAY)||0,i=localStorage.getItem(t.STORE_KEY.STATUS)||0,l=localStorage.getItem(t.STORE_KEY.GUID)||1392841634,u=localStorage.getItem(t.STORE_KEY.CID)||205361747;try{n=JSON.parse(n)}catch(e){n=null}n||(localStorage.setItem(t.STORE_KEY.LIST,a.default),n=JSON.parse(a.default));let S=new Audio;S.autoplay=!1,S.addEventListener("timeupdate",function(e){const a=100*S.currentTime/S.duration;s.dispatch(e=>e.setIn(["seconds"],S.currentTime)),t.updateProgress(a)}),t.next=(()=>{const e=s.getState(),a=e.getIn(["current"]),r=e.getIn(["way"]),n=e.getIn(["list"]).size;switch(r){case 0:t.changeSong(1+a);break;case 1:t.changeSong(n+a-1);break;case 2:t.changeSong(Math.random()*n|0);break;case 3:t.changeSong(a)}}),S.addEventListener("ended",t.next),t.load=(()=>{const e=s.getState(),a=e.getIn(["list",e.get("current")]).toJS(),n=e.getIn(["progress"]),o=e.getIn(["status"]);document.title=a.songname,r.jsonp("https://c.y.qq.com/base/fcgi-bin/fcg_music_express_mobile3.fcg",{g_tk:5738,loginUin:0,hostUin:0,format:"json",inCharset:"utf8",outCharset:"utf-8",notice:0,platform:"yqq",needNewCode:0,cid:u,uin:0,songmid:a.songmid,filename:`C400${a.songmid}.m4a`,guid:l},function(e){const{filename:a,vkey:s}=e.data.items[0];S.src=`//dl.stream.qqmusic.qq.com/${a}?vkey=${s}&guid=${l}&uin=0&fromtag=66`,setTimeout(function(){n&&t.changeProgress(n),o||S.play()},500)}),r.ajax({url:"lrc/"+a.songmid+".json",success:function(e){s.dispatch(t=>t.setIn(["lyric"],e.lyric||"歌词加载失败！"))},error:function(){s.dispatch(e=>e.setIn(["lyric"],"歌词加载失败！"))}})}),t.updateProgress=(e=>{s.dispatch(t=>t.setIn(["progress"],e||0)),localStorage.setItem(t.STORE_KEY.PROGRESS,e+"")}),t.changeProgress=(e=>{t.updateProgress(e),S.duration*e&&(S.currentTime=S.duration*e/100)}),t.togglePlay=(()=>{let e;S.paused?(S.play(),e=0):(S.pause(),e=1),s.dispatch(t=>t.setIn(["status"],e)),localStorage.setItem(t.STORE_KEY.STATUS,e+"")}),t.changeWay=(()=>{let e=Number(s.getState().getIn(["way"]))||0;e=(e+1)%4,s.dispatch(t=>t.setIn(["way"],e)),localStorage.setItem(t.STORE_KEY.WAY,e+"")}),t.init=(()=>(s.dispatch(e=>{return e.merge({list:n,current:(Number(o)||0)%(n.size||1),progress:Number(c)||0,way:Number(g),status:Number(i)})}),t.changeSong(Number(o)||0))),t.changeSong=(e=>{const a=s.getState().getIn(["list"]).size;e%=a,localStorage.setItem(t.STORE_KEY.CURRENT,e+""),localStorage.setItem(t.STORE_KEY.PROGRESS,"0"),s.dispatch(t=>t.merge({current:e,progress:0})),t.load()})});