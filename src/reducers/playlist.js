define("reducers/playlist",["require","exports","./playlistdata","../store","wfquery"],function(e,t,r,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.STORE_KEY={LIST:"y_playlist",CURRENT:"y_current",PROGRESS:"y_progress",GUID:"pgv_pvid",CID:"cid"};let o=localStorage.getItem(t.STORE_KEY.LIST),a=localStorage.getItem(t.STORE_KEY.CURRENT),i=localStorage.getItem(t.STORE_KEY.PROGRESS),c=localStorage.getItem(t.STORE_KEY.GUID)||1392841634,g=localStorage.getItem(t.STORE_KEY.CID)||205361747;try{o=JSON.parse(o)}catch(e){o=null}o||(localStorage.setItem(t.STORE_KEY.LIST,r.default),o=JSON.parse(r.default));let l=new Audio;l.autoplay=!0,l.addEventListener("timeupdate",function(e){const r=100*l.currentTime/l.duration;s.dispatch(e=>e.setIn(["seconds"],l.currentTime)),t.updateProgress(r)}),l.addEventListener("ended",function(e){const r=s.getState().getIn(["current"]);t.changeSong(1+r)}),t.load=(()=>{const e=s.getState(),t=e.getIn(["list",e.get("current")]).toJS();n.jsonp("https://c.y.qq.com/base/fcgi-bin/fcg_music_express_mobile3.fcg",{g_tk:5738,loginUin:0,hostUin:0,format:"json",inCharset:"utf8",outCharset:"utf-8",notice:0,platform:"yqq",needNewCode:0,cid:g,uin:0,songmid:t.songmid,filename:`C400${t.songmid}.m4a`,guid:c},function(e){const{filename:t,vkey:r}=e.data.items[0];l.src=`//dl.stream.qqmusic.qq.com/${t}?vkey=${r}&guid=${c}&uin=0&fromtag=66`,l.play()}),n.ajax({url:"/lrc/"+t.songmid+".json",success:function(e){s.dispatch(t=>t.setIn(["lyric"],e.lyric||"歌词加载失败！"))},error:function(){s.dispatch(e=>e.setIn(["lyric"],"歌词加载失败！"))}})}),t.updateProgress=(e=>{s.dispatch(t=>t.setIn(["progress"],e||0)),localStorage.setItem(t.STORE_KEY.PROGRESS,e+"")}),t.changeProgress=(e=>{t.updateProgress(e),l.duration*e&&(l.currentTime=l.duration*e/100)}),t.init=(()=>(s.dispatch(e=>{return e.merge({list:o,current:(Number(a)||0)%(o.size||1),progress:Number(i)||0})}),t.changeSong(Number(a)||0))),t.changeSong=(e=>{const r=s.getState().getIn(["list"]).size;e%=r,localStorage.setItem(t.STORE_KEY.CURRENT,e+""),localStorage.setItem(t.STORE_KEY.PROGRESS,"0"),s.dispatch(t=>t.merge({current:e,progress:0})),t.load()})});