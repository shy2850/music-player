define("reducers/playlist",["require","exports","./playlistdata","../store","wfquery"],function(e,t,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.STORE_KEY={LIST:"y_playlist",CURRENT:"y_current",PROGRESS:"y_progress",GUID:"pgv_pvid",CID:"cid"};let s=localStorage.getItem(t.STORE_KEY.LIST),n=localStorage.getItem(t.STORE_KEY.CURRENT),i=localStorage.getItem(t.STORE_KEY.PROGRESS),g=localStorage.getItem(t.STORE_KEY.GUID)||1392841634,c=localStorage.getItem(t.STORE_KEY.CID)||205361747;try{s=JSON.parse(s)}catch(e){s=null}s||(localStorage.setItem(t.STORE_KEY.LIST,r.default),s=JSON.parse(r.default));let l=new Audio;l.autoplay=!0,l.addEventListener("timeupdate",function(e){const r=100*l.currentTime/l.duration;t.updateProgress(r)}),l.addEventListener("ended",function(e){const r=o.getState().getIn(["current"]);t.changeSong(1+r)}),t.load=(()=>{const e=o.getState(),t=e.getIn(["list",e.get("current")]).toJS();a.jsonp("https://c.y.qq.com/base/fcgi-bin/fcg_music_express_mobile3.fcg",{g_tk:5738,loginUin:0,hostUin:0,format:"json",inCharset:"utf8",outCharset:"utf-8",notice:0,platform:"yqq",needNewCode:0,cid:c,uin:0,songmid:t.songmid,filename:`C400${t.songmid}.m4a`,guid:g},function(e){const{filename:t,vkey:r}=e.data.items[0];l.src=`http://dl.stream.qqmusic.qq.com/${t}?vkey=${r}&guid=${g}&uin=0&fromtag=66`,l.play()})}),t.updateProgress=(e=>{o.dispatch(t=>t.setIn(["progress"],e||0)),localStorage.setItem(t.STORE_KEY.PROGRESS,e+"")}),t.changeProgress=(e=>{t.updateProgress(e),l.duration*e&&(l.currentTime=l.duration*e/100)}),t.init=(()=>(o.dispatch(e=>{return e.merge({list:s,current:(Number(n)||0)%(s.size||1),progress:Number(i)||0})}),t.changeSong(Number(n)||0))),t.changeSong=(e=>{const r=o.getState().getIn(["list"]).size;e%=r,localStorage.setItem(t.STORE_KEY.CURRENT,e+""),localStorage.setItem(t.STORE_KEY.PROGRESS,"0"),o.dispatch(t=>t.merge({current:e,progress:0})),t.load()})});